# syntax=docker/dockerfile:1

FROM mcr.microsoft.com/playwright

WORKDIR /app


COPY package*.json .

RUN npm ci

COPY tsconfig.json .
COPY .aegir.js .
COPY test ./test
COPY src ./src

RUN npm run build

# warmup the test
RUN initial_setup=true npm test -- --types false --build false --grep "^$" -t browser

ENTRYPOINT [ "npm", "test", "--", "--build", "false", "--types", "false", "-t", "browser" ]